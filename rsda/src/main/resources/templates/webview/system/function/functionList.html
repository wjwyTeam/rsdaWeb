<!--
 * @Descripttion: 
 * @version: v0.0.1
 * @Author: ZHANGQI
 * @Date: 2019-12-17 19:08:33
 * @LastEditors  : zgr
 * @LastEditTime : 2019-12-31 10:52:32
 -->
<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">

<head>
  <th:block th:include="include :: header('服务器监控')" />
  <style>
    .col-lg-1, .col-lg-10, .col-lg-11, .col-lg-12, .col-lg-2, .col-lg-3, .col-lg-4, .col-lg-5, .col-lg-6, .col-lg-7, .col-lg-8, .col-lg-9, .col-md-1, .col-md-10, .col-md-11, .col-md-12, .col-md-2, .col-md-3, .col-md-4, .col-md-5, .col-md-6, .col-md-7, .col-md-8, .col-md-9, .col-sm-1, .col-sm-10, .col-sm-11, .col-sm-12, .col-sm-2, .col-sm-3, .col-sm-4, .col-sm-5, .col-sm-6, .col-sm-7, .col-sm-8, .col-sm-9, .col-xs-1, .col-xs-10, .col-xs-11, .col-xs-12, .col-xs-2, .col-xs-3, .col-xs-4, .col-xs-5, .col-xs-6, .col-xs-7, .col-xs-8, .col-xs-9 {
        position: relative;
        min-height: 1px;
        padding-right: 0px;
        padding-left: 10px;
   }
    .functionTableSearch {
      width: 100%;
      text-align: right;
      position: relative;
      top: 6px;
    }
    .layui-btn-normal {
      background-color: #8a8eee;
    }
    #type-button{
      padding: 3px 10px;
      color: #ffffff;
      background-color: #1c84c6;
      border-radius: 5px;
    }
    #visible-button{
      padding: 3px 10px;
      color: #ffffff;
      background-color: #1ab394;
      border-radius: 10px;
    }
  </style>
</head>

<body class="page-no-scroll">
  <div class="col-xs-12">
    <table class="layui-hide" id = "functionTable" lay-filter="functionTable"></table> 
    <!-- 表格操作列 -->
    <script type="text/html" id="demoTreeTableBar1">
      <a class="layui-btn layui-btn layui-btn-sm" lay-event="edit"><i class="layui-icon layui-icon-edit"></i>编辑</a>
      <a class="layui-btn layui-btn-normal layui-btn-sm" lay-event="add"><i class="layui-icon layui-icon-add-1"></i>新增</a>
      <a class="layui-btn layui-btn-danger layui-btn-sm" lay-event="del"><i class="layui-icon layui-icon-delete"></i>删除</a>
    </script>

    <!-- 表格状态列 -->
    <script type="text/html" id="demoTreeTableState1">
      <input type="checkbox" lay-filter="ckState" value="{{d.id}}" lay-skin="switch"
            lay-text="正常|锁定" {{d.state==0?'checked':''}}/>
    </script>

  </div>
  <div class="page-loading">
    <div class="ball-loader sm">
        <span></span><span></span><span></span><span></span>
    </div>
</div>
 
  <input type="hidden" id="deptId">
  <script src="/layuiadmin/layui/layui.js" type="text/javascript" th:inline="none"></script>
  <script>
    layui.config({
      base: '/layuiadmin/' //静态资源所在路径
    }).extend({
      treeTable: 'treetable-lay/treeTable',
    }).use(["util", 'treeTable','layer','table'], function () {
      var $ = layui.$
        , form = layui.form
        , table = layui.table
        , util = layui.util
        , treeTable = layui.treeTable;

           // 渲染表格
           var insTb = treeTable.render({
            elem: '#functionTable',
            tree: {
                iconIndex: 2,
                arrowType: 'arrow2'
            },
            cellMinWidth: 80, //全局定义常规单元格的最小宽度，layui 2.2.1 新增  列宽自动分配
            id: "functionTable",
            cols: [
                { type:"checkbox", align: 'center', LAY_CHECKED: false, filter: 'test' }
                , { type: 'numbers', title: '编号', align: 'center',width:70}
                , { field: 'functionName', title: '菜单名称'}
                // , { field: 'forder', title: '排序', align: 'center' }
                , { field: 'url', title: '请求地址', align: 'center' }
                , { field: 'functionType', title: '类型', align: 'center',templet:function(d){
                      return  '<span id="type-button">'+d.functionType+'</span>'
                  }}
                , { field: 'visible', title: '可见', align: 'center' ,templet:function(d){
                     var visible = "";
                     if(visible == true){
                       return  '<span id="visible-button">显示</span>'
                     }else{
                       return  '<span id="visible-button">不显示</span>'
                     }
                 }}
                , { field: 'perms', title: '权限标识', align: 'center' }
                , {
                    field: 'createTime', title: '创建时间',align: 'center', templet: function (d) {
                        return util.toDateString(d.createTime);
                    },
                },
                // {templet: '#demoTreeTableState1', title: '状态',align: 'center'},
                {align: 'center', toolbar: '#demoTreeTableBar1', title: '操作', width: 280}
        
            ],
            reqData: function (data, callback) {
                setTimeout(function () {  // 故意延迟一下
                    // // var url = '/webviews/list.json';
                    var url = "/function/functionTree?groupId=";
                    url += (data ? (data.id) : '');
                    $.get(url, function (res) {
                        callback(res.data);
                    });
                }, 800);
            },
            style: 'margin-top:0;'
        });
        setTimeout(function () {
            $('body').children('.page-loading').hide();
            $('body').removeClass('page-no-scroll');
        }, 100);

        
       treeTable.on('tool(functionTable)', function (obj) {
          var data = obj.data;
          console.log(data)
          if(obj.event === "del"){
            layer.confirm('确认要删除吗？', function (index) {
            layer.close(index);
            $.post("/group/deleteGroup", {id: data.id }, function (resultJSONObject) {
              if (resultJSONObject.success) { 
                // tableLoad(table);
              }
              layer.msg(resultJSONObject.msg);
            }, "json");
            });
            
          }else if(obj.event === "edit"){
            console.log(data.id);
             //open 方法合作共用json串
          layer.open({
            type: 2,
            title: '编辑用户',
            maxmin: true,
            area: ['700px', '550px'],
            btn: ['确定', '取消'],
            fixed: true,
            shadeClose: false,
            shade: 0.2,
            moveType: 1,  //拖拽模式，0或者1 
            content: '/function/functionEdit?functionId=' + data.id,
            yes: function (index, layero) {
              var iframeWindow = window['layui-layer-iframe' + index]
                , submitID = 'roleSubmitTwo'
                , submit = layero.find('iframe').contents().find('#' + submitID);
              //监听提交
              iframeWindow.layui.form.on('submit(' + submitID + ')', function (dataLog) {
                var field = dataLog.field;
                if (field.roleStatus == "true") {
                  field.roleStatus = true;
                } else {
                  field.roleStatus = false;
                }
                if (field.isCandel == "true") {
                  field.roleStatus = true;
                } else {
                  field.isCandel = false;
                }
                //获取提交的字段
                //提交 Ajax 成功后，静态更新表格中的数据
                $.ajax({
                  type: "post",
                  url: "/role/updateRole",
                  data: JSON.stringify(field),
                  dataType: "json",
                  contentType: "application/json;charset-UTF-8",
                  success: function (resultJSONObject) {
                    if (resultJSONObject.success) {
                      tableLoad(table);
                    }
                    layer.msg(resultJSONObject.msg);
                  }
                });
                layer.close(index); //关闭弹层
              });
              submit.trigger('click');
            }
          });
          }
       })

      });

      function treeTableLoad(table) {
        treeTable.reload({elem : '#functionTable'});
      }

    
        
  </script>
</body>

</html>